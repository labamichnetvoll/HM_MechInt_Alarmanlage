<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Reisealarmanlage Steuerung</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f4ff;
      padding: 20px;
      text-align: center;
    }
    h1 { color: #2c3e50; }
    .status {
      margin: 20px 0;
      font-size: 18px;
    }
    select, button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
      border-radius: 6px;
    }
    .alarm {
      background-color: red;
      color: white;
      padding: 15px;
      font-weight: bold;
      display: none;
      border-radius: 8px;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>Reisealarmanlage</h1>

  <!-- Statusanzeigen -->
  <div class="status">
    <div><strong>GerÃ¤testatus:</strong> <span id="geraetStatus">MODUS HOTEL</span></div>
    <div><strong>Aktueller Modus:</strong> <span id="modusStatus">HOTEL</span></div>
    <div><strong>Ãœberwachung:</strong> <span id="ueberwachungStatus">INAKTIV</span></div>
  </div>

  <!-- Modusauswahl -->
  <label for="modus">Modus wÃ¤hlen:</label>
  <select id="modus" onchange="modusWechseln()">
    <option value="hotel">HOTEL</option>
    <option value="gepaeck">GEPÃ„CK</option>
    <option value="zelt">ZELT</option>
  </select>

  <!-- Ãœberwachungssteuerung -->
  <div>
    <button onclick="starteUeberwachung()">ðŸ”’ Starte Ãœberwachung</button>
    <button onclick="stoppeUeberwachung()">ðŸ”“ Beende Ãœberwachung</button>
  </div>

  <!-- Alarmanzeige -->
  <div id="alarmBox" class="alarm">ðŸš¨ ALARM!!!</div>

  <script>
    async function modusWechseln() {
      const modus = document.getElementById("modus").value;
      try {
        await fetch("/modus?typ=" + modus);
        // danach Status neu laden
        ladeStatus();
      } catch (e) {
        console.error(e);
      }
    }

    async function starteUeberwachung() {
      try {
        await fetch("/start");
        ladeStatus();
      } catch (e) {
        console.error(e);
      }
    }

    async function stoppeUeberwachung() {
      try {
        await fetch("/stop");
        ladeStatus();
      } catch (e) {
        console.error(e);
      }
    }

    async function ladeStatus() {
      try {
        const res = await fetch("/status");
        if (!res.ok) return;
        const data = await res.json();

        document.getElementById("geraetStatus").innerText       = data.geraet;
        document.getElementById("modusStatus").innerText        = data.modus;
        document.getElementById("ueberwachungStatus").innerText = data.ueberwachung;

        // Dropdown passend zum Modus setzen
        const select = document.getElementById("modus");
        const m = data.modus.toLowerCase();
        if (m === "hotel" || m === "gepÃ¤ck" || m === "zelt") {
          // Ã¤ -> ae fÃ¼r Value
          let value = m.replace("Ã¤", "ae");
          select.value = value;
        }

        // Alarmanzeige
        document.getElementById("alarmBox").style.display =
          data.alarm ? "block" : "none";

      } catch (e) {
        console.error("Status konnte nicht geladen werden:", e);
      }
    }

    // Alle 1 s Status vom Arduino holen
    setInterval(ladeStatus, 1000);
    // Beim Laden der Seite einmalig Status holen
    ladeStatus();
  </script>
</body>
</html>
