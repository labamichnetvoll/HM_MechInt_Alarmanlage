<!ErklÃ¤rung zu den GET-Requests ist unter dem Code>

<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Reisealarmanlage Steuerung</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f4ff;
      padding: 20px;
      text-align: center;
    }
    h1 { color: #2c3e50; }
    .status {
      margin: 20px 0;
      font-size: 18px;
    }
    button, label {
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      border-radius: 6px;
    }
    .sensor-group {
      margin: 20px 0;
      font-size: 16px;
    }
    .sensor-group label {
      display: block;
      margin: 5px 0;
    }
    .alarm {
      background-color: red;
      color: white;
      padding: 15px;
      font-weight: bold;
      display: none;
      border-radius: 8px;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>Reisealarmanlage</h1>

  <!-- Statusanzeigen -->
  <div class="status">
    <div><strong>GerÃ¤testatus:</strong> <span id="geraetStatus">BEREIT</span></div>
    <div><strong>Aktive Sensoren:</strong> <span id="sensorStatus">KEINE</span></div>
    <div><strong>Ãœberwachung:</strong> <span id="ueberwachungStatus">INAKTIV</span></div>
  </div>

  <!-- Sensorauswahl -->
  <div class="sensor-group">
    <strong>Sensoren auswÃ¤hlen:</strong>
    <label>
      <input type="checkbox" id="sensor_ultraschall">
      Ultraschallsensor
    </label>
    <label>
      <input type="checkbox" id="sensor_beschleunigung">
      Beschleunigungssensor
    </label>
    <label>
      <input type="checkbox" id="sensor_ir">
      IR-Sensor
    </label>
  </div>

  <!-- Ãœberwachungssteuerung -->
  <div>
    <button onclick="starteUeberwachung()">ðŸ”’ Starte Ãœberwachung</button>
    <button onclick="stoppeUeberwachung()">ðŸ”“ Beende Ãœberwachung</button>
  </div>

  <!-- Alarmanzeige -->
  <div id="alarmBox" class="alarm">ðŸš¨ ALARM!!!</div>

  <script>
    async function starteUeberwachung() {
      // AusgewÃ¤hlte Sensoren auslesen
      const ultraschall    = document.getElementById("sensor_ultraschall").checked ? 1 : 0;
      const beschleunigung = document.getElementById("sensor_beschleunigung").checked ? 1 : 0;
      const ir             = document.getElementById("sensor_ir").checked ? 1 : 0;

      // Wenn gar kein Sensor gewÃ¤hlt ist, abbrechen
      if (ultraschall === 0 && beschleunigung === 0 && ir === 0) {
        alert("Bitte mindestens einen Sensor auswÃ¤hlen.");
        return;
      }

      const url = `/start?ultraschall=${ultraschall}&beschleunigung=${beschleunigung}&ir=${ir}`;

      try {
        await fetch(url);
        ladeStatus();
      } catch (e) {
        console.error(e);
      }
    }

    async function stoppeUeberwachung() {
      try {
        await fetch("/stop");
        ladeStatus();
      } catch (e) {
        console.error(e);
      }
    }

    async function ladeStatus() {
      try {
        const res = await fetch("/status");
        if (!res.ok) return;
        const data = await res.json();

        document.getElementById("geraetStatus").innerText       = data.geraet       || "-";
        document.getElementById("ueberwachungStatus").innerText = data.ueberwachung || "-";

        // Sensor-Status aus JSON Ã¼bernehmen (0/1 oder true/false)
        const ultraschallAktiv    = !!data.ultraschall;
        const beschleunigungAktiv = !!data.beschleunigung;
        const irAktiv             = !!data.ir;

        document.getElementById("sensor_ultraschall").checked    = ultraschallAktiv;
        document.getElementById("sensor_beschleunigung").checked = beschleunigungAktiv;
        document.getElementById("sensor_ir").checked             = irAktiv;

        const aktive = [];
        if (ultraschallAktiv)    aktive.push("Ultraschallsensor");
        if (beschleunigungAktiv) aktive.push("Beschleunigungssensor");
        if (irAktiv)             aktive.push("IR-Sensor");

        document.getElementById("sensorStatus").innerText =
          aktive.length ? aktive.join(", ") : "KEINE";

        // Alarmanzeige
        document.getElementById("alarmBox").style.display =
          data.alarm ? "block" : "none";

      } catch (e) {
        console.error("Status konnte nicht geladen werden:", e);
      }
    }

    // Alle 1 s Status vom Arduino holen
    setInterval(ladeStatus, 1000);
    // Beim Laden der Seite einmalig Status holen
    ladeStatus();
  </script>
</body>
</html>


<!  ErklÃ¤rung zu den GET-Requests:
      Start Befehl:
            Wenn man auf "Starte Ãœberwachung" drÃ¼ckt, werden die Checkboxen ausgelesen und als GET Parameter an den Arduino gesendet
                Beispiel: /start?ultraschall=1&beschleunigung=0&ir=1
      Stop Befehl:
            Wenn man auf "Ãœberwachung Stoppen" drÃ¼ckt, werden alle Sensoren abgeschaltet, die Ãœberwachung beendet und der Alarmstatus zurÃ¼ckgesetzt
                Befehl: /stop
      Status Befehl:
            Jede Sekunde frÃ¤gt die Website "/status" ab. Der Arduino muss dann eine JSON zurÃ¼ckschicken
                JSON Beispiel:    {
                                  "geraet": "BEREIT",
                                  "ueberwachung": "AKTIV",
                                  "alarm": false,
                                  "ultraschall": 1,
                                  "beschleunigung": 0,
                                  "ir": 1
                                  }
            Das wird gebraucht um die Checkboxen zu aktualisieren, die Textanzeigen (Ã¼ber den Checkboxen) zu aktualisieren, 
            Alarm ein oder ausblenden, Liste aktiver sensoren richtig darzustellen.
>
